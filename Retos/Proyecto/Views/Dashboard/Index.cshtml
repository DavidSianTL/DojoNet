@model IEnumerable<Proyecto.Models.Producto>

@{
    ViewData["Title"] = "Dashboard de Productos";
}

@if (TempData["SuccessMessage"] != null)
{
    <script>
        Swal.fire("Éxito", "@TempData["SuccessMessage"]", "success");
    </script>
}

@if (TempData["ErrorMessage"] != null)
{
    <script>
        Swal.fire("Error", "@TempData["ErrorMessage"]", "error");
    </script>
}

<link rel="stylesheet" href="dark-theme.css">

<div class="container">
    <h2>Dashboard de Productos</h2>

    <table class="table dark-table">
        <thead>
            <tr>
                <th>Nombre</th>
                <th>Precio</th>
                <th>Cantidad</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            @if (Model == null || !Model.Any())
            {
                <tr>
                    <td colspan="4" class="text-center empty-row">No hay productos disponibles.</td>
                </tr>
            }
            else
            {
                @foreach (var producto in Model)
                {
                    <tr>
                        <td>@producto.Nombre</td>
                        <td>@producto.Precio.ToString("C")</td>
                        <td>@producto.Cantidad</td>
                        <td>
                            <a href="@Url.Action("Edit", "Producto", new { id = producto.Id })" class="btn btn-primary">Editar</a>
                            <form asp-action="Delete" method="post" style="display: inline;" class="delete-form">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@producto.Id" />
                                <button type="button" class="btn btn-danger btn-delete" data-producto="@producto.Nombre">
                                    Eliminar
                                </button>
                            </form>
                        </td>
                    </tr>
                }
            }
        </tbody>
    </table>

    <a href="@Url.Action("Create", "Producto")" class="btn btn-success">Nuevo Producto</a>
</div>

<!-- Scripts de SweetAlert -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const deleteButtons = document.querySelectorAll(".btn-delete");

        deleteButtons.forEach(button => {
            button.addEventListener("click", function () {
                const form = this.closest("form");
                const producto = this.getAttribute("data-producto");

                Swal.fire({
                    title: "¿Estás seguro?",
                    text: `Eliminarás el producto "${producto}". Esta acción no se puede deshacer.`,
                    icon: "warning",
                    showCancelButton: true,
                    confirmButtonColor: "#d33",
                    cancelButtonColor: "#3085d6",
                    confirmButtonText: "Sí, eliminar",
                    cancelButtonText: "Cancelar"
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit(); // Enviar el formulario si se confirma
                    }
                });
            });
        });
    });
</script>
