@model IEnumerable<_Evaluacion_Mensual_Abril.Models.ProductsViewModel>
@{
	ViewData["Title"] = "Productos";
}
<div class="products-page animation-global">

    <div class="bubbles">
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
        <div class="bubble"></div>
    </div>

    <div class="products-header">
        <h2>@ViewData["Title"]</h2>
        <a href="@Url.Action("Create", "Products")" class="btn btn-primary">
            <i class="fas fa-plus-circle me-1"></i> Agregar Producto
        </a>
    </div>

    <div class="products-table table-responsive">
        <table id="productos-table" class="table table-hover mb-0">
            <thead>
                <tr>
                    <th>Código</th>
                    <th>Producto</th>
                    <th>Descripción</th>
                    <th>Precio</th>
                    <th>Categoría</th>
                    <th>Stock</th>
                    <th>Proveedor</th>
                    <th>Fecha Ingreso</th>
                    <th class="text-center">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @if (!Model?.Any() ?? true)
                {
                    <tr>
                        <td colspan="9" class="text-center py-4">No hay registros</td>
                    </tr>
                }
                else
                {
                    foreach (var p in Model)
                    {
                        <tr>
                            <td>@p.Codigo</td>
                            <td>@p.Nombre</td>
                            <td class="text-truncate" style="max-width:150px;">@p.Descripcion</td>
                            <td>@p.Precio.ToString("C", System.Globalization.CultureInfo.GetCultureInfo("es-GT"))</td>
                            <td>@p.Categoria</td>
                            <td>@p.Stock</td>
                            <td>@p.Proveedor</td>
                            <td>@p.FechaIngreso</td>
                            <td class="text-center">
                                <a href="@Url.Action("Update", "Products", new { id = p.Codigo })" class="btn btn-sm btn-outline-warning me-1">
                                    <i class="fas fa-pen"></i>
                                </a>
                                <button class="btn btn-sm btn-outline-danger" onclick="mostrarAlertaEliminar(@p.Codigo)">
                                    <i class="fas fa-trash-alt"></i>
                                </button>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
</div>

@section Scripts {
    <script src="~/js/sweetAlerts.js" asp-append-version="true"></script>
    <script>
        $(function(){
            $('#productos-table').DataTable({
                responsive: true,
                language: {
                    url: '//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json'
                },
                dom: 'ft<"d-flex justify-content-between"lp>',
                pagingType: 'full_numbers',
                lengthMenu: [5,10,25],
                order: [[0,'desc']]
            });
        });

        function mostrarAlertaEliminar(id) {
            Swal.fire({
                title: '¿Confirmar eliminación?',
                text: "Esta acción no se puede deshacer",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Sí, eliminar',
                cancelButtonText: 'Cancelar',
                buttonsStyling: false,
                customClass: {
                    confirmButton: 'btn btn-danger me-2',
                    cancelButton: 'btn btn-secondary'
                }
            }).then((res) => {
                if (res.isConfirmed) {
                    window.location.href = `/Products/DeleteProduct/${id}`;
                }
            });
        }

        // Seguridad de sesión
        (function(){
            var ses = sessionStorage.getItem('sesionActiva');
            if (ses!=='true' || !'@Context.Session.GetString("UsrNombre")') {
                location.href = '@Url.Action("Login", "Login")';
            }
        })();
    </script>
}