@{
    ViewData["Title"] = "Login Page";
}

<style>
    body {
        background-image: linear-gradient(rgba(0, 0, 0, 0.4), rgba(0, 0, 0, 0.4)), url('@Url.Content("~/images/login-fondo.jpg")');
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
    }

</style>    

<div class="container login-container animation-global">
    <div class="row justify-content-center">
        <div class="col-md-4">
            <div class="login-card p-5">

                <!-- Formulario de Login -->
                <div id="login-form">
                    <h3 class="text-center mb-4">Iniciar Sesión</h3>
                    <form asp-action="Login" asp-controller="Login" method="post">
                        <div class="form-group mb-3">
                            <label>Usuario</label>
                            <input type="text" class="form-control" name="UsrNombre" required />
                        </div>
                        <div class="form-group mb-3 position-relative">
                            <label>Contraseña</label>
                            <input type="password" class="form-control" name="Password" id="login-password" required />
                            <span toggle="#login-password" class="toggle-password fa fa-eye position-absolute" style="top: 38px; right: 15px; cursor: pointer;"></span>
                        </div>
                        <button type="submit" class="btn btn-primary w-100 mb-2">Ingresar</button>
                        <button type="button" class="btn btn-secondary w-100" id="show-register">¿No tienes cuenta? Registrarse</button>
                    </form>
                </div>

                <!-- Formulario de Registro -->
                <div id="register-form" style="display:none;">
                    <h3 class="text-center mb-4">Registrar Cuenta</h3>
                    <form id="formRegister"
                          asp-action="Register"
                          asp-controller="Login"
                          method="post">
                        <div class="form-group mb-3">
                            <label>Nombre Completo</label>
                            <input type="text"
                                   class="form-control"
                                   name="NombreCompleto"
                                   required
                                   minlength="3"
                                   maxlength="100" />
                        </div>
                        <div class="form-group mb-3">
                            <label>Usuario</label>
                            <input type="text"
                                   class="form-control"
                                   name="UsrNombre"
                                   required
                                   minlength="3"
                                   maxlength="50" />
                        </div>
                        <div class="form-group mb-3 position-relative">
                            <label>Contraseña</label>
                            <input type="password"
                                   class="form-control"
                                   name="Password"
                                   id="register-password"
                                   required
                                   minlength="6"
                                   maxlength="100" />
                            <span toggle="#register-password"
                                  class="toggle-password fa fa-eye position-absolute"
                                  style="top:38px; right:15px; cursor:pointer;"></span>
                        </div>
                        <button type="button"
                                id="btnRegister"
                                class="btn btn-success w-100 mb-2">
                            Registrar
                        </button>
                        <button type="button"
                                id="show-login"
                                class="btn btn-secondary w-100">
                            ¿Ya tienes cuenta? Iniciar sesión
                        </button>
                    </form>
                </div>

            </div>
        </div>
    </div>
</div>

@section Scripts{
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        var error = '@ViewBag.Error';

        if (error && error !== '') {
            Swal.fire({
                icon: 'error',
                title: 'Error al iniciar sesión',
                text: error
            });
        }

        // Verificar que todo este correcto
        document.getElementById('btnRegister').addEventListener('click', ()=>{
          const form = document.getElementById('formRegister');
          if (!form.checkValidity()) {
            const invalid = form.querySelector(':invalid');
            const label   = form.querySelector(`label[for="${invalid.id}"]`)?.innerText
                            || invalid.name;
            let msg;
            switch (invalid.name) {
              case 'NombreCompleto':
                msg = 'Debe tener entre 3 y 100 caracteres.'; break;
              case 'UsrNombre':
                msg = 'Debe tener entre 3 y 50 caracteres.'; break;
              case 'Password':
                msg = 'Debe tener entre 6 y 100 caracteres.'; break;
              default:
                msg = invalid.validationMessage;
            }
            return Swal.fire({
              icon: 'error',
              title: 'Campo inválido',
              text: `${label}: ${msg}`
            });
          }

          // Si todo es válido, confirmamos
          Swal.fire({
            title: '¿Registrar cuenta?',
            icon: 'question',
            showCancelButton: true,
            confirmButtonText: 'Sí, registrar',
            cancelButtonText: 'Cancelar',
            customClass: {
              confirmButton: 'btn-confirm',
              cancelButton: 'btn-cancel'
            },
            buttonsStyling: false
          }).then((result)=>{
            if (result.isConfirmed) form.submit();
          });
        });

        // Transiciones entre login y registro
        $("#show-register").click(function () {
            $("#login-form").fadeOut(200, function () {
                $("#register-form").fadeIn(200);
            });
        });

        $("#show-login").click(function () {
            $("#register-form").fadeOut(200, function () {
                $("#login-form").fadeIn(200);
            });
        });

        // Función para mostrar la contraseña
        $(".toggle-password").click(function () {
            var input = $($(this).attr("toggle"));
            var type = input.attr("type") === "password" ? "text" : "password";
            input.attr("type", type);
            $(this).toggleClass("fa-eye fa-eye-slash");
        });

    </script>
}