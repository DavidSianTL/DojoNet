@{
	ViewData["Title"] = "ApiUsuarios";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2 class="text-center my-4">Usuarios desde API</h2>

<div class="container">
	<table class="table table-bordered table-hover">
		<thead class="table-dark">
			<tr>
				<th>Id</th>
				<th>Usuario</th>
				<th>Nombre</th>
				<th>Email</th>
			</tr>
		</thead>
		<tbody id="listaUsuarios">
			<!-- Se llenará con JS -->
		</tbody>
		<tfoot>
			<tr>
				<td colspan="4">Total de usuarios: <span id="totalUsuarios"></span></td>
			</tr>
		</tfoot>
	</table>
</div>

<!-- Modal -->
<div class="modal fade" id="modalUsuario" tabindex="-1" aria-labelledby="modalUsuarioLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="modalUsuarioLabel">Detalles del Usuario</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
			</div>
			<div class="modal-body">
				<!--<p><strong>Nombre:</strong> <span id="modalNombre"></span></p>
				<p><strong>Email:</strong> <span id="modalEmail"></span></p>-->
				<p><strong>Teléfono:</strong> <span id="modalTelefono"></span></p>
				<p><strong>Empresa:</strong> <span id="modalEmpresa"></span></p>
				<p><strong>Sitio Web:</strong> <span id="modalWeb"></span></p>
				<p><strong>Ciudad:</strong> <span id="modalCiudad"></span></p>
				<p><strong>Dirección:</strong> <span id="modalDireccion"></span></p>
				<a id="linkMaps" class="btn btn-primary mt-2" href="#" target="_blank">Ver en Google Maps</a>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<script>
		async function cargarUsuarios() {
			try {
				const response = await fetch("https://jsonplaceholder.typicode.com/users");
				const data = await response.json();

				let tbody = document.getElementById("listaUsuarios");
				let total = document.getElementById("totalUsuarios");

				tbody.innerHTML = "";
				total.textContent = data.length;

				data.forEach(usuario => {
					let tr = document.createElement("tr");
					tr.innerHTML = `
						<td>${usuario.id}</td>
						<td>${usuario.username}</td>
						<td>${usuario.name}</td>
						<td>${usuario.email}</td>
					`;
					tr.style.cursor = "pointer";
					tr.addEventListener("click", () => mostrarModal(usuario));
					tbody.appendChild(tr);
				});
			} catch (error) {
				console.error("Error al cargar los usuarios:", error);
			}
		}

		function mostrarModal(usuario) {
			//document.getElementById("modalNombre").textContent = usuario.name;
			//document.getElementById("modalEmail").textContent = usuario.email;
			document.getElementById("modalTelefono").textContent = usuario.phone;
			document.getElementById("modalEmpresa").textContent = usuario.company.name;
			document.getElementById("modalWeb").textContent = usuario.website;
			document.getElementById("modalCiudad").textContent = usuario.address.city;

			const direccionCompleta = `${usuario.address.street}, ${usuario.address.suite}, ${usuario.address.city}, ${usuario.address.zipcode}`;
			document.getElementById("modalDireccion").textContent = direccionCompleta;

			const mapsLink = `https://www.google.com/maps?q=${usuario.address.geo.lat},${usuario.address.geo.lng}`;
			document.getElementById("linkMaps").href = mapsLink;

			let modal = new bootstrap.Modal(document.getElementById("modalUsuario"));
			modal.show();
		}

		cargarUsuarios();
	</script>
}
