@model ProyectoDojoGeko.Models.Usuario.UsuarioIndexViewModel
@{
    ViewData["Title"] = "Gestión de Usuarios";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<!-- CSS global del sistema -->
<link rel="stylesheet" href="~/css/geko-global.css" />
<!-- CSS específico para usuarios -->
<link rel="stylesheet" href="~/css/usuarios-views.css" />

<div class="usuarios-container">
    <!-- Header usando clase global -->
    <div class="HeaderPagina">
        <div class="contenido">
            <div>
                <h1 class="titulo">
                    <i class="fas fa-users"></i>
                    Gestión de Usuarios
                </h1>
                <p class="subtitulo">Administra los usuarios del sistema GEKO</p>
            </div>
            <div>
                <button type="button" class="BtnPrimario" onclick="crearUsuario()">
                    <i class="fas fa-plus"></i>
                    Crear Usuario
                </button>
            </div>
        </div>
    </div>

    <!-- Filtros usando clases globales -->
    <div class="ContenedorFiltros" id="FiltrosUsuarios">
        <div class="FilaFiltros">
            <div class="GrupoFiltro">
                <label class="EtiquetaCampo" for="filtroEstado">Estado:</label>
                <select id="filtroEstado" class="CampoEntrada" onchange="aplicarFiltros()">
                    <option value="">Todos</option>
                    <option value="true">Activo</option>
                    <option value="false">Inactivo</option>
                </select>
            </div>

            <div class="GrupoFiltro">
                <label class="EtiquetaCampo" for="filtroRol">Rol:</label>
                <select id="filtroRol" class="CampoEntrada" onchange="aplicarFiltros()">
                    <option value="">Todos los roles</option>
                    @if (Model.Roles != null)
                    {
                        foreach (var rol in Model.Roles)
                        {
                    <option value="@rol.IdRol">@rol.NombreRol</option>
                        }
                    }
                </select>
            </div>

            <div class="GrupoFiltro search-group">
                <label class="EtiquetaCampo" for="busqueda">Buscar:</label>
                <div class="ContenedorBusqueda">
                    <input type="text" id="busqueda" class="CampoEntrada CampoBusqueda" placeholder="Username o empleado..." onkeyup="buscarUsuarios()" />
                    <i class="fas fa-search icono-busqueda"></i>
                </div>
            </div>

            <div class="GrupoFiltro">
                <button type="button" class="BtnSecundario" onclick="limpiarFiltros()">
                    <i class="fas fa-times"></i>
                    Limpiar
                </button>
            </div>
        </div>
    </div>

    <!-- Tabla usando clase global -->
    <div class="CardStandard">
        <div class="CardHeader">
            <div class="Flex JustificarEntre AlignearCentro">
                <span class="InfoPaginacion">
                    Total: <strong id="totalUsuarios">@Model.TotalUsuarios</strong> usuarios
                </span>
                <select id="registrosPorPagina" class="CampoEntrada" onchange="cambiarRegistrosPorPagina()" style="width: auto;">
                    <option value="10">10 por página</option>
                    <option value="25">25 por página</option>
                    <option value="50">50 por página</option>
                </select>
            </div>
        </div>

        <div class="CardBody SinPadding">
            <table class="TablaIndex" id="TablaUsuarios">
                <thead>
                    <tr>
                        <th onclick="ordenarTabla('IdUsuario')" class="ColumnaOrdenable">
                            ID <i class="fas fa-sort"></i>
                        </th>
                        <th onclick="ordenarTabla('Username')" class="ColumnaOrdenable">
                            Username <i class="fas fa-sort"></i>
                        </th>
                        <th onclick="ordenarTabla('Empleado')" class="ColumnaOrdenable">
                            Empleado <i class="fas fa-sort"></i>
                        </th>
                        <th onclick="ordenarTabla('Estado')" class="ColumnaOrdenable">
                            Estado <i class="fas fa-sort"></i>
                        </th>
                        <th onclick="ordenarTabla('FechaCreacion')" class="ColumnaOrdenable">
                            Fecha Creacion <i class="fas fa-sort"></i>
                        </th>
                        <th>Roles</th>
                        <th class="TextoCentrado">Acciones</th>
                    </tr>
                </thead>
                <tbody id="tablaUsuariosBody">
                    @if (Model.Usuarios != null && Model.Usuarios.Any())
                    {
                        foreach (var usuario in Model.Usuarios)
                        {
                    <tr data-usuario-id="@usuario.IdUsuario">
                        <td class="TextoPrimario">@usuario.IdUsuario</td>
                        <td class="usuario-username">
                            <div class="username-container">
                                <i class="fas fa-user user-icon"></i>
                                <span>@usuario.Username</span>
                            </div>
                        </td>
                        <td>
                            @if (usuario.Empleado != null)
                                    {
                            <div class="empleado-info">
                                <span class="empleado-nombre">@usuario.Empleado.NombreEmpleado @usuario.Empleado.ApellidoEmpleado</span>
                                
                            </div>
                                    }
                                    else
                                    {
                            <span class="TextoMuted">Sin empleado asignado</span>
                                    }
                        </td>
                        <td>
                            @if (usuario.Estado)
                                    {
                            <span class="EstadoActivo">
                                <i class="fas fa-check-circle"></i> Activo
                            </span>
                                    }
                                    else
                                    {
                            <span class="EstadoInactivo">
                                <i class="fas fa-times-circle"></i> Inactivo
                            </span>
                                    }
                        </td>
                        <td class="usuario-fecha">
                            <span class="fecha-texto">@usuario.FechaCreacion.ToString("dd/MM/yyyy")</span>
                            <small class="fecha-hora">@usuario.FechaCreacion.ToString("HH:mm")</small>
                        </td>
                        <td class="roles-container">
                            <span class="loading-roles">Cargando...</span>
                        </td>
                        <td class="TextoCentrado" id="AccionesUsuarios">
                            <div class="Flex JustificarCentro" style="gap: 4px;">
                                <button type="button" class="BtnAccion ver" onclick="verDetalle(@usuario.IdUsuario)" title="Ver detalle">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button type="button" class="BtnAccion editar" onclick="editarUsuario(@usuario.IdUsuario)" title="Editar">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button type="button" class="BtnAccion activar" onclick="asignarRoles(@usuario.IdUsuario)" title="Asignar roles">
                                    <i class="fas fa-user-tag"></i>
                                </button>
                                @if (usuario.Estado)
                                        {
                                <button type="button" class="BtnAccion eliminar" onclick="cambiarEstado(@usuario.IdUsuario, false)" title="Desactivar">
                                    <i class="fas fa-ban"></i>
                                </button>
                                        }
                                        else
                                        {
                                <button type="button" class="BtnAccion activar" onclick="cambiarEstado(@usuario.IdUsuario, true)" title="Activar">
                                    <i class="fas fa-check"></i>
                                </button>
                                        }
                            </div>
                        </td>
                    </tr>
                        }
                    }
                    else
                    {
                    <tr>
                        <td colspan="7" class="TextoCentrado">
                            <div class="PaddingSuperior PaddingInferior">
                                <i class="fas fa-users fa-3x TextoMuted"></i>
                                <h4 class="MargenSuperior">No hay usuarios registrados</h4>
                                <p class="TextoMuted">Comienza creando tu primer usuario del sistema</p>
                                <button type="button" class="BtnPrimario MargenSuperior" onclick="crearUsuario()">
                                    <i class="fas fa-plus"></i>
                                    Crear Usuario
                                </button>
                            </div>
                        </td>
                    </tr>
                    }
                </tbody>
            </table>
        </div>

        <!-- Paginación usando clases globales -->
        <div class="ContenedorPaginacion" id="paginacionContainer">
            <div class="InfoPaginacion">
                Mostrando 1 a @Model.TotalUsuarios de @Model.TotalUsuarios usuarios
            </div>
            <nav aria-label="Paginación de usuarios">
                <ul class="pagination" id="paginacion">
                    <!-- La paginación se generará dinámicamente -->
                </ul>
            </nav>
        </div>
    </div>
</div>

<!-- Modal usando clases globales -->
<div class="modal fade ModalStandard" id="modalCambiarEstado" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="ModalHeader">
                <h5 class="modal-title">
                    <i class="fas fa-exchange-alt"></i>
                    Confirmar cambio de estado
                </h5>
                <button type="button" class="close text-white" data-dismiss="modal">
                    <span>&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="mensajeCambioEstado"></p>
            </div>
            <div class="modal-footer">
                <button type="button" class="BtnSecundario" data-dismiss="modal">
                    <i class="fas fa-times"></i>
                    Cancelar
                </button>
                <button type="button" class="BtnPrimario" id="confirmarCambioEstado">
                    <i class="fas fa-check"></i>
                    Confirmar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript específico -->
<script src="~/js/usuarios-views.js"></script>
