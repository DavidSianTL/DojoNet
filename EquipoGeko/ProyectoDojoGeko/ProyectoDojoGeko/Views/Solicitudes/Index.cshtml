@model List<ProyectoDojoGeko.Models.SolicitudViewModel>
@{
    ViewData["Title"] = "Solicitudes de Vacaciones";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";

    var contrato = Context.Session.GetString("TipoContrato");
    var codigo = Context.Session.GetString("CodigoEmpleado");
    var nombre = Context.Session.GetString("NombreCompletoEmpleado");
    var diasDisponibles = ViewBag.DiasDisponibles;
    var estados = (List<SelectListItem>)ViewBag.Estados;
    var fecha = DateTime.UtcNow;
}

<div class="solicitudes-container">
    <div class="page-header">
        <div class="header-content">
            <h1 class="page-title">
                <i class="fas fa-plane-departure"></i>
                Solicitudes de Vacaciones
            </h1>
            <p class="page-subtitle">
                Consulta y gestiona tus solicitudes de vacaciones.
            </p>
        </div>
    </div>

    <div class="form-card empleado-info-card">
        <div class="info-row">
            <span style="display:none;">C�digo: <strong>@(codigo ?? "-----")</strong></span>
            <span>Fecha: <strong>@fecha.ToString("dd/MM/yyyy")</strong></span>
            <span>Días disponibles: <strong>@(ViewBag.DiasDisponibles ?? "--")</strong></span>
        </div>
        <div class="info-row">
            <span>Nombre: <strong>@(nombre ?? "-----")</strong></span>
            <span>Código: <strong>@(codigo ?? "-----")</strong></span>
        </div>
    </div>

    <div class="form-card solicitudes-list-card">
        <div class="solicitudes-header">
            <h2><i class="fas fa-list"></i> Solicitudes</h2>

        </div>
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>No. Solicitud</th>
                    <th>Fecha Ingreso</th>
                    <th>Días Solicitados</th>
                    <th>Estado</th>
                </tr>
            </thead>
            <tbody>
                @if (Model != null && Model.Count > 0)
                {
                    @for (int i = 0; i < Model.Count; i++)
                    {
                        var solicitud = Model[i];
                        <tr class="main-row" data-toggle="collapse" data-target="#detalles-@solicitud.Encabezado.IdSolicitud" style="cursor:pointer;">
                            <td>@solicitud.Encabezado.IdSolicitud</td>
                            <td>@solicitud.Encabezado.FechaIngresoSolicitud</td>
                            <td>@solicitud.Encabezado.DiasSolicitadosTotal</td>
                            <td>
                                @{
                                    var estadoTexto = estados.FirstOrDefault(e => e.Value == solicitud.Encabezado.Estado.ToString())?.Text ?? "Desconocido";
                                }
                                <span class="badge badge-success">@estadoTexto</span>
                            </td>
                        </tr>
                        <tr class="collapse-row" id="detalles-@solicitud.Encabezado.IdSolicitud" style="display:none;">
                            <td colspan="4">
                                <strong>Fechas solicitadas:</strong>
                                <ul>
                                    @foreach (var detalle in solicitud.Detalles)
                                    {
                                        <li>
                                            @detalle.FechaInicio.ToString("dd/MM/yyyy") - @detalle.FechaFin.ToString("dd/MM/yyyy") (@detalle.DiasHabilesTomados día(s))
                                        </li>
                                    }
                                </ul>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="4" class="text-center">No hay solicitudes registradas.</td>
                    </tr>
                }
            </tbody>
        </table>
        <div class="actions-container">
            <button class="btn-submit"><i class="fas fa-plus"></i> Agregar solicitud</button>
            <button class="btn-cancel"><i class="fas fa-times"></i> Cancelar solicitud</button>
            <button class="btn-reset"><i class="fas fa-paper-plane"></i> Solicitar autorización</button>
        </div>
    </div>
</div>

@section Styles {
    <link rel="stylesheet" href="~/css/empleado-form.css" />
    <style>
        .solicitudes-container {
            padding: 20px;
        }

        .page-header {
            margin-bottom: 20px;
        }

        .page-title {
            font-size: 26px;
            color: #0B2B64;
            margin-bottom: 5px;
        }

        .page-subtitle {
            font-size: 14px;
            color: #6c757d;
        }

        .form-card {
            background: #fff;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            margin-bottom: 25px;
        }

        .empleado-info-card .info-row {
            display: flex;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 15px;
        }

        .solicitudes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

            .solicitudes-header h2 {
                font-size: 20px;
                color: #0B2B64;
            }

        .btn-print {
            background-color: #f8f9fa;
            border: 1px solid #ced4da;
            color: #0B2B64;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }

            .btn-print i {
                margin-right: 5px;
            }

        .table {
            width: 100%;
            font-size: 15px;
        }

            .table th {
                background-color: #0B2B64;
                color: white;
            }

            .table td, .table th {
                padding: 10px;
                text-align: center;
            }

        .badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 13px;
        }

        .badge-success {
            background-color: #198754;
            color: white;
        }

        .badge-secondary {
            background-color: #6c757d;
            color: white;
        }

        .badge-info {
            background-color: #0dcaf0;
            color: white;
        }

        .actions-container {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-submit,
        .btn-cancel,
        .btn-reset {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            color: white;
            cursor: pointer;
            font-size: 14px;
        }

        .btn-submit {
            background-color: #003C9D;
        }

        .btn-cancel {
            background-color: #6c757d;
        }

        .btn-reset {
            background-color: #F39C12;
        }

            .btn-submit i,
            .btn-cancel i,
            .btn-reset i {
                margin-right: 6px;
            }
    </style>
}

@section Scripts {
    <script>
        document.querySelectorAll('.main-row').forEach(row => {
            row.addEventListener('click', function (e) {
                // Evita que el evento se propague si haces click en un botón dentro de la fila
                if (e.target.tagName === 'BUTTON' || e.target.closest('button')) return;

                const targetId = this.getAttribute('data-target');
                const detalleRow = document.querySelector(targetId);
                const icon = this.querySelector('.fa-chevron-down, .fa-chevron-up');
                if (detalleRow.style.display === "none" || !detalleRow.style.display) {
                    detalleRow.style.display = "table-row";
                    if (icon) {
                        icon.classList.remove('fa-chevron-down');
                        icon.classList.add('fa-chevron-up');
                    }
                } else {
                    detalleRow.style.display = "none";
                    if (icon) {
                        icon.classList.remove('fa-chevron-up');
                        icon.classList.add('fa-chevron-down');
                    }
                }
            });
        });
    </script>
}